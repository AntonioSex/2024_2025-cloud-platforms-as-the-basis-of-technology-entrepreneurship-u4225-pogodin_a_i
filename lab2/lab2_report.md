<div align="center">
University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FTMI](https://ftmi.itmo.ru/)

Course: [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/) 

Year: 2024/2025

Group: U4225

Author: Pogodin Anton Igorevich

Lab: Lab2

Date of create: 25.09.2024

Date of finished: 2Х.09.2024
</div>

## Описание
Это вторая лабораторная работа "Исследование Cloud Run"

## Цель работы
Ознакомиться с работой Cloud Run.

## Ход работы
Cloud Run - это управляемая вычислительная платформа, которая позволяет запускать контейнеры (изолированная среда для приложения) непосредственно поверх масштабируемой инфраструктуры Google.

1. Создал Cloud Run из представленного дефолтного сервиса с минимальным количеством ресурсов.
На фото ниже показано, что ресурсы минимальные.
![image](https://github.com/user-attachments/assets/60eb5466-b977-445b-aff3-a53c8ec5f24c)

Первая версия была создана на порту 8080 - cтандартный порт для веб-сервисов.

Образ контейнера задеплоен:

![image](https://github.com/user-attachments/assets/e54b2b5a-f901-4d56-b3d8-e0c8c1c56817)


2. Проанализировал логи:

![image](https://github.com/user-attachments/assets/5e377a17-53fc-4a44-9883-d16e5c708904)


В логах можно увидеть, что служба Cloud Run с именем "hello-pogodin-ai" была успешно создана в регионе "us-central1" пользователем "zhenolan@gmail.com" с помощью Google Cloud Console. Далее можно по логам можно увидеть, что служба Cloud Run «hello-pogodin-ai» принимает запросы на порту 8080, а также можно увидеть информацию об успешно принятых HTTP GET-запросах.

3. Проанализировал метрики:

Среди метрик представлены следующие: количество запросов, задержка запросов, количество экзмепляров контейнера, оплачиваемое время экземпляра контейнера, загрузка ЦП контейнера, использование памяти котнейнера, количество отправленных и полученных байтов, максимальное количество одновременных запросов и задержка запуска контейнера.

Активность на отображаемых графиках метрик происходила за счет того, что я обращалась к странице с информацией о запуске образа контейнера (см.выше).

![image](https://github.com/user-attachments/assets/a137a207-8c23-49be-a069-e8aa1b4b4e04)

![image](https://github.com/user-attachments/assets/23ed89d2-7af3-447f-98d4-c2ab5a87e644)

![image](https://github.com/user-attachments/assets/394fd272-6276-42f8-a1ee-bc7fb59ae46d)

4. Далее создал еще один образ контейнера на порту 8090 - альтернативный порт для веб-сервисов

![image](https://github.com/user-attachments/assets/285b201f-ebd0-418d-864f-4c17a3f8f5d3)

6. Проанализировал логи:

![image](https://github.com/user-attachments/assets/2c6cb307-4e3c-4dc7-bf6b-feba7afde313)

В логах можно отметить, что произошло успешное обновление сервиса Cloud Run "ivanova-t" в регионе "us-central1", служба Cloud Run «hello-ivanovat» принимает запросы на порту 8090 и также можно увидеть информацию об успешно принятых HTTP GET-запросах.

7. Проанализировала метрики:
![image](https://github.com/user-attachments/assets/fae03635-cb06-4f9f-8050-c991263b497e)
![image](https://github.com/user-attachments/assets/9076fb0a-568f-4589-9940-f222707d6ef3)
![image](https://github.com/user-attachments/assets/6ccd8a14-500f-4866-842c-8a83f3389186)
![image](https://github.com/user-attachments/assets/d36ae4c7-6b7c-41e7-b878-fea51c05c4bb)
![image](https://github.com/user-attachments/assets/ba4a19f9-f121-4d0c-aa01-1392995582e3)

Можно отметить, что метрики начали изменяться такие, как количество запросов (уменьшение до 0), задержка запроса (рост до 11 ms), количество экзмепляров контейнера (увеличение до одного), оплачиваемое время экземпляра контейнера (уменьшение до 0), количество отправленных и полученных байтов (уменьшение до 0), максимальное количество одновременных запросов (увеличение до 2).

9. Протестировала переключения трафика между версиями:
    
90%/10%:

![image](https://github.com/user-attachments/assets/f2cd9338-3530-471b-abe3-c20be8175728)

Лог, показывающий распределение трафика:

![image](https://github.com/user-attachments/assets/0110bd45-cf02-44c9-8513-d9248d0d843c)

50%/50%:

![image](https://github.com/user-attachments/assets/f50aa61e-2346-415a-b27a-03577f22b856)

Лог, показывающий распределение трафика:

![image](https://github.com/user-attachments/assets/00382d7b-2b80-4b0b-8da9-965b7cbb55b8)

Повторила переключение в таких же пропорциях еще один раз.

Для того, чтобы проследить, как распределяется трафик между версиями, я обращалась к сайту с информацией о запуске контейнера несколько раз, что можно увидеть по логам - GET200 (успешно принятые HTTP GET-запросы):

![image](https://github.com/user-attachments/assets/b636028f-ba59-4cdc-babb-9e31616573e5)

При распределении трафика 90%/10% больше трафика принимает на себя версия на порту 8080 (как раз на этой версии трафик распределялся в пропорции 90%), а при распределении трафика 50%/50% обе версии принимают на себя примерно одинаковое количестов трафика.

Это можно отследить с помощью отслеживание метрики "Количество запросов":

Распределение трафика 90%/10%:

![image](https://github.com/user-attachments/assets/fab8577e-f519-4d17-8ca6-85f6413c8872)


Распределение трафика 50%/50% - распределение трафика начинает уравниваться:

![image](https://github.com/user-attachments/assets/4530645a-990c-4b64-890a-4bdc377ef2cf)


10. Удалила за собой все созданные сервисы

## Выводы

Создание разных версий контейнера позволяет распределять трафик и создавать правила его распределения, что является ключевым аспектом для того, чтобы контролировать развертывание приложений, проводить A/B тестирование, вводить новые функции постепенно и управлять версиями приложений.
